<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Budget & Économies — Kevin Croy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <style>
    :root{
      --bg:#0c1117;
      --panel:#121826;
      --muted:#9aa3b2;
      --text:#e8edf2;
      --outline:rgba(255,255,255,.08);
      --ring:rgba(46,168,255,.25);
      --green:#22c55e; --blue:#60a5fa; --amber:#f59e0b; --rose:#fb7185; --grey:#cbd5e1;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:#0c1117;color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    header{position:sticky;top:0;z-index:20;background:#0c1117cc;backdrop-filter:blur(8px);border-bottom:1px solid var(--outline)}
    header .bar{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;gap:12px;align-items:center}
    .dot{width:10px;height:10px;border-radius:50%;background:#22c55e}
    h1{font-size:18px;margin:0}
    .badge{border:1px solid var(--outline);color:var(--muted);padding:6px 10px;border-radius:999px;font-size:12px}
    .spacer{flex:1}
    .btn{background:#111827;border:1px solid var(--outline);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,#16a34a,#22c55e);color:#06240f;border:none;font-weight:700}
    .btn.warn{background:#1f2937;border:1px solid #334155}
    .wrap{max-width:1200px;margin:0 auto;padding:20px 16px 80px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:1100px){.grid{grid-template-columns:380px 1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border:1px solid var(--outline);border-radius:16px;padding:16px}
    .row{display:grid;grid-template-columns:1fr 140px;gap:10px;align-items:center;margin-top:8px}
    label{font-size:13px;color:var(--muted)}
    input,select{width:140px;padding:10px;border-radius:10px;border:1px solid var(--outline);background:#0f1522;color:var(--text);outline:none}
    input:focus,select:focus{border-color:#2ea8ff;box-shadow:0 0 0 4px var(--ring)}
    .hr{height:1px;background:var(--outline);margin:10px 0}
    .legend{display:flex;gap:14px;flex-wrap:wrap;margin:6px 0 8px}
    .dotLegend{width:10px;height:10px;border-radius:50%;display:inline-block}
    .kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
    .kpi{background:rgba(255,255,255,.04);border:1px solid var(--outline);border-radius:12px;padding:10px}
    .kpi .lab{font-size:12px;color:var(--muted)}
    .kpi .val{font-size:18px;font-weight:700;margin-top:2px}
    .section{margin-top:10px}
    .secHead{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .pill{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--outline);color:var(--muted)}
    .list{display:grid;gap:10px}
    .item{display:grid;grid-template-columns:1fr 110px 110px 28px;gap:8px;align-items:center}
    .item input[type="text"]{width:100%;padding:10px;border-radius:10px;border:1px solid var(--outline);background:#0f1522;color:var(--text)}
    .delete{background:#1f2937;border:1px solid #334155;color:#fda4af;border-radius:8px;cursor:pointer}
    .addRow{margin-top:8px}
    table{width:100%;border-collapse:collapse}
    thead th{background:rgba(255,255,255,.05);padding:10px;color:#cbd5e1;text-align:left}
    tbody td{border-top:1px solid var(--outline);padding:10px;color:#dbe2ea}
    .tip{font-size:13px;color:#cfe8ff}
  </style>
</head>
<body>
<header>
  <div class="bar">
    <div class="dot"></div>
    <h1>Budget & Économies — <strong>Kevin Croy</strong></h1>
    <span class="badge">Fixes</span>
    <span class="badge">Variables</span>
    <span class="badge">Obligatoires</span>
    <div class="spacer"></div>
    <button id="share" class="btn">Partager</button>
    <button id="csv" class="btn primary">Exporter CSV</button>
  </div>
</header>

<div class="wrap">
  <div class="grid">
    <!-- LEFT: Inputs -->
    <div class="card">
      <div class="row"><label>Revenu net mensuel (€)</label><input id="revenu" type="number" value="2500"></div>
      <div class="row"><label>Taux d’épargne cible (%)</label><input id="tauxEpargne" type="number" value="20"></div>
      <div class="row"><label>Taille du foyer</label>
        <select id="foyer">
          <option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option>
        </select>
      </div>
      <div class="hr"></div>

      <div class="section">
        <div class="secHead"><h3 style="margin:0">Dépenses fixes</h3><span class="pill">loyer, assurances, abonnements…</span></div>
        <div id="listFixes" class="list"></div>
        <button id="addFixe" class="btn addRow">+ Ajouter une dépense fixe</button>
      </div>

      <div class="section">
        <div class="secHead"><h3 style="margin:0">Dépenses variables</h3><span class="pill">courses, sorties, carburant…</span></div>
        <div id="listVariables" class="list"></div>
        <button id="addVariable" class="btn addRow">+ Ajouter une dépense variable</button>
      </div>

      <div class="section">
        <div class="secHead"><h3 style="margin:0">Obligatoires</h3><span class="pill">impôts, remboursements, cantine…</span></div>
        <div id="listOblig" class="list"></div>
        <button id="addOblig" class="btn addRow">+ Ajouter une dépense obligatoire</button>
      </div>

      <div class="hr"></div>
      <div class="section">
        <button id="reset" class="btn warn">Réinitialiser (conserver sauvegarde)</button>
        <button id="clear" class="btn warn">Effacer la sauvegarde</button>
      </div>
    </div>

    <!-- RIGHT: KPIs + Charts + Insights -->
    <div class="card">
      <div class="kpis">
        <div class="kpi"><div class="lab">Dépenses fixes</div><div id="k_fixes" class="val">—</div></div>
        <div class="kpi"><div class="lab">Variables</div><div id="k_variables" class="val">—</div></div>
        <div class="kpi"><div class="lab">Obligatoires</div><div id="k_oblig" class="val">—</div></div>
        <div class="kpi"><div class="lab">Épargne potentielle</div><div id="k_epargne" class="val">—</div></div>
        <div class="kpi"><div class="lab">Taux d’épargne</div><div id="k_taux" class="val">—</div></div>
      </div>

      <div class="legend">
        <span><span class="dotLegend" style="background:var(--green)"></span> Fixes</span>
        <span><span class="dotLegend" style="background:var(--amber)"></span> Variables</span>
        <span><span class="dotLegend" style="background:var(--rose)"></span> Obligatoires</span>
        <span><span class="dotLegend" style="background:var(--blue)"></span> Épargne</span>
      </div>
      <div style="height:300px"><canvas id="chart"></canvas></div>

      <div class="hr"></div>
      <h3 style="margin:0 0 8px">Opportunités d’économies (auto)</h3>
      <ul id="tips" class="tip"></ul>

      <div class="hr"></div>
      <h3 style="margin:0 0 8px">Vue détaillée</h3>
      <div style="overflow:auto">
        <table id="tab">
          <thead><tr><th>Catégorie</th><th>Intitulé</th><th>Mensuel (€)</th><th>Fixe/Variable/Oblig.</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  const KEY='budget-v1';
  const € = n => new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR',maximumFractionDigits:0}).format(n||0);
  const el = id => document.getElementById(id);

  // Prefill defaults (France-ish)
  const defaults = {
    revenu: 2500, tauxEpargne: 20, foyer: 3,
    fixes: [
      {name:'Loyer / Crédit logement', amount: 950},
      {name:'Assurance habitation', amount: 20},
      {name:'Assurance auto', amount: 55},
      {name:'Électricité + gaz', amount: 90},
      {name:'Forfaits mobiles', amount: 40},
      {name:'Internet', amount: 30},
      {name:'Abonnements (SVOD, musique…)', amount: 35},
      {name:'Mutuelle santé', amount: 45},
    ],
    variables: [
      {name:'Courses', amount: 450},
      {name:'Carburant / Transports', amount: 120},
      {name:'Restaurants / Cafés', amount: 120},
      {name:'Loisirs / Sport', amount: 60},
      {name:'Divers', amount: 80},
    ],
    oblig: [
      {name:'Impôt mensuel', amount: 150},
      {name:'Cantine / Crèche', amount: 120},
      {name:'Remboursement crédit conso', amount: 90},
    ]
  };

  // State
  let state = loadSaved() || JSON.parse(JSON.stringify(defaults));

  // Elements
  const lists = {
    fixes: el('listFixes'),
    variables: el('listVariables'),
    oblig: el('listOblig')
  };

  // Render list items
  function renderList(kind){
    const container = lists[kind];
    container.innerHTML = '';
    state[kind].forEach((it, idx) => {
      const row = document.createElement('div');
      row.className = 'item';
      row.innerHTML = `
        <input type="text" value="${it.name||''}" placeholder="Intitulé">
        <input type="number" value="${it.amount||0}" min="0" step="1">
        <span style="color:#94a3b8;font-size:12px">€/mois</span>
        <button class="delete">×</button>
      `;
      const [title,input] = row.querySelectorAll('input');
      const del = row.querySelector('.delete');
      title.addEventListener('input', e => { it.name = e.target.value; changed(); });
      input.addEventListener('input', e => { it.amount = Number(e.target.value||0); changed(); });
      del.addEventListener('click', () => { state[kind].splice(idx,1); changed(); renderAll(); });
      container.appendChild(row);
    });
  }

  function addItem(kind, name='', amount=0){ state[kind].push({name, amount}); renderList(kind); changed(); }

  // Build UI initial
  function renderLeft(){
    // set header inputs
    el('revenu').value = state.revenu;
    el('tauxEpargne').value = state.tauxEpargne;
    el('foyer').value = state.foyer;
    renderList('fixes'); renderList('variables'); renderList('oblig');
  }

  // Compute totals & KPIs
  function compute(){
    const sum = arr => arr.reduce((a,b)=> a + Number(b.amount||0), 0);
    const fixes = sum(state.fixes);
    const variables = sum(state.variables);
    const oblig = sum(state.oblig);
    const depenses = fixes + variables + oblig;
    const revenu = Number(state.revenu||0);
    const epargnePot = Math.max(0, revenu - depenses);
    const taux = revenu>0 ? (epargnePot / revenu * 100) : 0;
    return {fixes, variables, oblig, depenses, revenu, epargnePot, taux};
  }

  function renderKPIs(){
    const k = compute();
    el('k_fixes').textContent = €(k.fixes);
    el('k_variables').textContent = €(k.variables);
    el('k_oblig').textContent = €(k.oblig);
    el('k_epargne').textContent = €(k.epargnePot);
    el('k_taux').textContent = isFinite(k.taux) ? k.taux.toFixed(1)+' %' : '—';
  }

  // Chart
  const chart = new Chart(el('chart'), {
    type:'doughnut',
    data:{
      labels:['Fixes','Variables','Obligatoires','Épargne'],
      datasets:[{data:[0,0,0,0], backgroundColor:['#22c55e','#f59e0b','#fb7185','#60a5fa']}]
    },
    options:{plugins:{legend:{labels:{color:'#dbe2ea'}}}}
  });

  function renderChart(){
    const k = compute();
    chart.data.datasets[0].data = [k.fixes, k.variables, k.oblig, Math.max(0,k.epargnePot)];
    chart.update('none');
  }

  // Tips engine (simple rules)
  function renderTips(){
    const k = compute();
    const tips = [];
    // 50/30/20 benchmark on revenu net
    const bFixes = 0.50 * k.revenu;
    const bVars  = 0.30 * k.revenu;
    const bSave  = 0.20 * k.revenu;

    if (k.fixes > bFixes) tips.push(`🔧 Tes dépenses <b>fixes</b> dépassent 50 % du revenu (${€(k.fixes)} vs ${€(bFixes)}). Pistes : renégocier box/forfaits, assurance auto/habitation, énergie, vérifier abonnements inutilisés.`);
    if (k.variables > bVars) tips.push(`🍽️ Tes <b>variables</b> dépassent ~30 % (${€(k.variables)} vs ${€(bVars)}). Pistes : liste de courses, batch cooking, plafonds hebdo, covoiturage.`);
    if (k.epargnePot < bSave) tips.push(`💰 Tu épargnes potentiellement ${€(k.epargnePot)} (< ${€(bSave)} visés). Idée : automatiser ${state.tauxEpargne}% le jour de paye.`);

    // Subscription detector
    const sub = state.fixes.find(x => /abonnements?|netflix|prime|canal|spotify|disney/i.test(x.name||''));
    if (sub && sub.amount >= 25) tips.push(`📺 <b>Abonnements</b> à ${€(sub.amount)} : pense au partage familial, aux offres annuelles, ou à geler 2 mois/12.`);

    // Energy + car insurance ranges
    const elec = state.fixes.find(x => /électric|gaz|ener/i.test(x.name||''));
    if (elec && elec.amount > 120) tips.push(`⚡ Énergie à ${€(elec.amount)} : simule un changement de fournisseur ou baisse de puissance.`);
    const car = state.fixes.find(x => /auto|voiture|carburant/i.test(x.name||''));
    if (car && car.amount > 150) tips.push(`🚗 Transport à ${€(car.amount)} : optimiser trajets, comparer assurances auto, vérifier pneus et pression.`);

    // Children
    const cantine = state.oblig.find(x => /cantine|cr[eè]che/i.test(x.name||''));
    if (cantine) tips.push(`👶 Pense aux <b>aides CAF</b> ou tarifs modulés pour ${cantine.name}.`);

    const list = el('tips');
    list.innerHTML = tips.length ? tips.map(t => `<li>${t}</li>`).join('') : '<li>Aucune alerte — ton budget est équilibré 👌</li>';
  }

  // Detail table
  function renderTable(){
    const tbody = document.querySelector('#tab tbody');
    const row = (cat, it, type) => `<tr><td>${cat}</td><td>${it.name||''}</td><td>${(it.amount||0).toFixed(0)}</td><td>${type}</td></tr>`;
    tbody.innerHTML = [
      ...state.fixes.map(it=>row('Fixe', it, 'Fixe')),
      ...state.variables.map(it=>row('Variable', it, 'Variable')),
      ...state.oblig.map(it=>row('Obligatoire', it, 'Obligatoire')),
    ].join('');
  }

  function renderAll(){
    renderKPIs(); renderChart(); renderTips(); renderTable();
  }

  function changed(){ save(); renderAll(); }

  // Save/Load
  function save(){ try{ localStorage.setItem(KEY, JSON.stringify(state)); }catch(e){} }
  function loadSaved(){ try{ return JSON.parse(localStorage.getItem(KEY)||''); }catch(e){ return null; } }

  // Bind header inputs
  el('revenu').addEventListener('input', e => { state.revenu = Number(e.target.value||0); changed(); });
  el('tauxEpargne').addEventListener('input', e => { state.tauxEpargne = Number(e.target.value||0); changed(); });
  el('foyer').addEventListener('change', e => { state.foyer = Number(e.target.value); changed(); });

  // Add buttons
  el('addFixe').addEventListener('click', ()=> addItem('fixes'));
  el('addVariable').addEventListener('click', ()=> addItem('variables'));
  el('addOblig').addEventListener('click', ()=> addItem('oblig'));

  // Reset / Clear
  el('reset').addEventListener('click', ()=>{ state = JSON.parse(JSON.stringify(defaults)); renderLeft(); changed(); });
  el('clear').addEventListener('click', ()=>{ localStorage.removeItem(KEY); state = JSON.parse(JSON.stringify(defaults)); renderLeft(); changed(); });

  // Share text
  el('share').addEventListener('click', ()=>{
    const k = compute();
    const text = `Mon budget mensuel — Revenu: ${€(k.revenu)} | Fixes: ${€(k.fixes)} | Variables: ${€(k.variables)} | Obligatoires: ${€(k.oblig)} | Épargne potentielle: ${€(k.epargnePot)} (${k.taux.toFixed(1)}%)`;
    if(navigator.share){ navigator.share({text}).catch(()=>{}); }
    else if(navigator.clipboard){ navigator.clipboard.writeText(text); alert('Résumé copié 📋'); }
  });

  // CSV export
  el('csv').addEventListener('click', ()=>{
    const rows = [['Categorie','Intitulé','Mensuel','Type']];
    state.fixes.forEach(x=>rows.push(['Fixe',x.name,x.amount,'Fixe']));
    state.variables.forEach(x=>rows.push(['Variable',x.name,x.amount,'Variable']));
    state.oblig.forEach(x=>rows.push(['Obligatoire',x.name,x.amount,'Obligatoire']));
    const csv = rows.map(r=>r.join(',')).join('\n');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob); const a = document.createElement('a');
    a.href=url; a.download='budget.csv'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
  });

  // Initial paint
  renderLeft(); renderAll();
})();
</script>
</body>
</html>
